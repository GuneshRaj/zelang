{{/* CRUD All Function Template */}}
{{.StructName}}** {{.StructName}}_all(int* count) {
    char *sql = "SELECT * FROM {{.TableName}}";
    sqlite3_stmt *stmt;

    int rc = sqlite3_prepare_v2(db, sql, -1, &stmt, NULL);
    if (rc != SQLITE_OK) {
        fprintf(stderr, "Failed to prepare statement: %s\n", sqlite3_errmsg(db));
        *count = 0;
        return NULL;
    }

    // Allocate array
    int capacity = 10;
    {{.StructName}}** results = ({{.StructName}}**)malloc(capacity * sizeof({{.StructName}}*));
    int n = 0;

    // Fetch all rows
    while ((rc = sqlite3_step(stmt)) == SQLITE_ROW) {
        if (n >= capacity) {
            capacity *= 2;
            results = ({{.StructName}}**)realloc(results, capacity * sizeof({{.StructName}}*));
        }

        {{.StructName}}* obj = ({{.StructName}}*)malloc(sizeof({{.StructName}}));

        // Read columns
        {{range $i, $f := .Fields}}
        {{if eq $f.CType "int64_t"}}
        obj->{{$f.Name}} = sqlite3_column_int64(stmt, {{$i}});
        {{else if eq $f.CType "double"}}
        obj->{{$f.Name}} = sqlite3_column_double(stmt, {{$i}});
        {{else if eq $f.CType "char*"}}
        obj->{{$f.Name}} = strdup((const char*)sqlite3_column_text(stmt, {{$i}}));
        {{else if eq $f.CType "int"}}
        obj->{{$f.Name}} = sqlite3_column_int(stmt, {{$i}});
        {{end}}
        {{end}}

        results[n++] = obj;
    }

    sqlite3_finalize(stmt);
    *count = n;
    return results;
}
